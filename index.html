<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Calculator Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-result {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .fix-button {
            background: #28a745;
        }
        .fix-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>ROI Calculator Debug Tool</h1>
    
    <div class="debug-section">
        <h2>1. Check Input Elements</h2>
        <button onclick="checkInputs()">Check All Inputs</button>
        <div id="inputResults"></div>
    </div>

    <div class="debug-section">
        <h2>2. Check CSS Issues</h2>
        <button onclick="checkCSS()">Check CSS Problems</button>
        <div id="cssResults"></div>
    </div>

    <div class="debug-section">
        <h2>3. Check JavaScript Initialization</h2>
        <button onclick="checkJS()">Check JavaScript</button>
        <div id="jsResults"></div>
    </div>

    <div class="debug-section">
        <h2>4. Test Input Functionality</h2>
        <button onclick="testInput()">Test Input Field</button>
        <div id="testResults"></div>
    </div>

    <div class="debug-section">
        <h2>5. Apply Fixes</h2>
        <button class="fix-button" onclick="applyFixes()">Apply All Fixes</button>
        <div id="fixResults"></div>
    </div>

    <script>
        function checkInputs() {
            const results = document.getElementById('inputResults');
            results.innerHTML = '';
            
            const inputIds = [
                'startKapitaal', 'lening', 'renteLening', 'looptijd', 'leningLooptijd',
                'rendementType', 'rendement', 'aflossingsType', 'herinvestering',
                'herinvesteringDrempel', 'vasteKosten', 'belastingType', 'inflatie'
            ];
            
            let foundCount = 0;
            let issueCount = 0;
            
            inputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    foundCount++;
                    const isDisabled = element.disabled;
                    const isReadOnly = element.readOnly;
                    const computedStyle = window.getComputedStyle(element);
                    const pointerEvents = computedStyle.pointerEvents;
                    const userSelect = computedStyle.userSelect;
                    
                    let status = 'success';
                    let issues = [];
                    
                    if (isDisabled) {
                        status = 'error';
                        issues.push('disabled');
                        issueCount++;
                    }
                    if (isReadOnly) {
                        status = 'error';
                        issues.push('readonly');
                        issueCount++;
                    }
                    if (pointerEvents === 'none') {
                        status = 'error';
                        issues.push('pointer-events: none');
                        issueCount++;
                    }
                    if (userSelect === 'none') {
                        status = 'warning';
                        issues.push('user-select: none');
                    }
                    
                    // Check if parent has hidden class
                    const formGroup = element.closest('.form-group');
                    if (formGroup && formGroup.classList.contains('hidden')) {
                        status = 'error';
                        issues.push('parent has .hidden class');
                        issueCount++;
                    }
                    
                    results.innerHTML += `
                        <div class="debug-result ${status}">
                            ${id}: ${issues.length ? issues.join(', ') : 'OK'}
                        </div>
                    `;
                } else {
                    results.innerHTML += `
                        <div class="debug-result error">
                            ${id}: NOT FOUND
                        </div>
                    `;
                }
            });
            
            results.innerHTML = `
                <div class="debug-result">
                    Found ${foundCount}/${inputIds.length} inputs. Issues found: ${issueCount}
                </div>
            ` + results.innerHTML;
        }

        function checkCSS() {
            const results = document.getElementById('cssResults');
            results.innerHTML = '';
            
            // Check for overlaying elements
            const input = document.getElementById('startKapitaal');
            if (input) {
                const rect = input.getBoundingClientRect();
                const elementAtPoint = document.elementFromPoint(
                    rect.left + rect.width / 2,
                    rect.top + rect.height / 2
                );
                
                if (elementAtPoint !== input) {
                    results.innerHTML += `
                        <div class="debug-result error">
                            Input is being overlapped by: ${elementAtPoint ? elementAtPoint.tagName + '.' + elementAtPoint.className : 'unknown'}
                        </div>
                    `;
                } else {
                    results.innerHTML += `
                        <div class="debug-result success">
                            No overlapping elements detected
                        </div>
                    `;
                }
                
                // Check z-index
                const zIndex = window.getComputedStyle(input).zIndex;
                results.innerHTML += `
                    <div class="debug-result">
                        Input z-index: ${zIndex}
                    </div>
                `;
            }
            
            // Check for problematic CSS classes
            const hiddenGroups = document.querySelectorAll('.form-group.hidden');
            if (hiddenGroups.length > 0) {
                results.innerHTML += `
                    <div class="debug-result error">
                        Found ${hiddenGroups.length} form groups with .hidden class
                    </div>
                `;
            }
        }

        function checkJS() {
            const results = document.getElementById('jsResults');
            results.innerHTML = '';
            
            // Check if app is initialized
            if (window.roiCalculatorApp) {
                results.innerHTML += `
                    <div class="debug-result success">
                        ROI Calculator App found
                    </div>
                `;
                
                if (window.roiCalculatorApp.initialized) {
                    results.innerHTML += `
                        <div class="debug-result success">
                            App is initialized
                        </div>
                    `;
                } else {
                    results.innerHTML += `
                        <div class="debug-result error">
                            App is NOT initialized
                        </div>
                    `;
                }
                
                // Check form manager
                if (window.roiCalculatorApp.formManager) {
                    const formElements = window.roiCalculatorApp.formManager.formElements;
                    results.innerHTML += `
                        <div class="debug-result">
                            Form elements registered: ${formElements ? formElements.size : 0}
                        </div>
                    `;
                }
            } else {
                results.innerHTML += `
                    <div class="debug-result error">
                        ROI Calculator App NOT found
                    </div>
                `;
            }
            
            // Check for event listeners
            const testInput = document.getElementById('startKapitaal');
            if (testInput) {
                // Try to get event listeners (this is limited in modern browsers)
                results.innerHTML += `
                    <div class="debug-result">
                        Testing event listeners...
                    </div>
                `;
                
                // Create a test to see if events fire
                let changeEventFired = false;
                let inputEventFired = false;
                
                const testChange = () => { changeEventFired = true; };
                const testInput = () => { inputEventFired = true; };
                
                testInput.addEventListener('change', testChange);
                testInput.addEventListener('input', testInput);
                
                // Simulate events
                testInput.dispatchEvent(new Event('input'));
                testInput.dispatchEvent(new Event('change'));
                
                results.innerHTML += `
                    <div class="debug-result ${inputEventFired ? 'success' : 'error'}">
                        Input event: ${inputEventFired ? 'Working' : 'Not working'}
                    </div>
                `;
                
                results.innerHTML += `
                    <div class="debug-result ${changeEventFired ? 'success' : 'error'}">
                        Change event: ${changeEventFired ? 'Working' : 'Not working'}
                    </div>
                `;
                
                // Clean up
                testInput.removeEventListener('change', testChange);
                testInput.removeEventListener('input', testInput);
            }
        }

        function testInput() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            // Create a test input
            results.innerHTML = `
                <div style="margin: 10px 0;">
                    <label>Test Input (type a number):</label><br>
                    <input type="number" id="testInputField" style="padding: 8px; border: 1px solid #ccc; width: 200px;">
                    <div id="testValue" style="margin-top: 10px;"></div>
                </div>
            `;
            
            const testField = document.getElementById('testInputField');
            const testValue = document.getElementById('testValue');
            
            testField.addEventListener('input', (e) => {
                testValue.innerHTML = `Value: ${e.target.value}`;
            });
            
            // Test if we can programmatically set value
            setTimeout(() => {
                testField.value = 123;
                testField.dispatchEvent(new Event('input'));
                
                results.innerHTML += `
                    <div class="debug-result ${testField.value == 123 ? 'success' : 'error'}">
                        Programmatic value setting: ${testField.value == 123 ? 'Working' : 'Not working'}
                    </div>
                `;
            }, 100);
        }

        function applyFixes() {
            const results = document.getElementById('fixResults');
            results.innerHTML = '';
            let fixCount = 0;
            
            // Fix 1: Remove hidden class from all form groups
            const hiddenGroups = document.querySelectorAll('.form-group.hidden');
            hiddenGroups.forEach(group => {
                group.classList.remove('hidden');
                group.classList.add('visible');
                fixCount++;
            });
            
            if (fixCount > 0) {
                results.innerHTML += `
                    <div class="debug-result success">
                        Removed .hidden class from ${fixCount} form groups
                    </div>
                `;
            }
            
            // Fix 2: Enable all inputs
            const inputs = document.querySelectorAll('input[type="number"], input[type="text"], select');
            let enabledCount = 0;
            inputs.forEach(input => {
                if (input.disabled) {
                    input.disabled = false;
                    enabledCount++;
                }
                if (input.readOnly) {
                    input.readOnly = false;
                    enabledCount++;
                }
                
                // Force pointer events
                input.style.pointerEvents = 'auto';
                
                // Ensure the parent form group is visible
                const formGroup = input.closest('.form-group');
                if (formGroup) {
                    formGroup.style.pointerEvents = 'auto';
                    formGroup.style.opacity = '1';
                    formGroup.style.display = 'block';
                }
            });
            
            if (enabledCount > 0) {
                results.innerHTML += `
                    <div class="debug-result success">
                        Enabled ${enabledCount} disabled/readonly inputs
                    </div>
                `;
            }
            
            // Fix 3: Re-initialize form manager if possible
            if (window.roiCalculatorApp && window.roiCalculatorApp.formManager) {
                try {
                    window.roiCalculatorApp.formManager.attachEventListeners();
                    results.innerHTML += `
                        <div class="debug-result success">
                            Re-attached event listeners
                        </div>
                    `;
                } catch (e) {
                    results.innerHTML += `
                        <div class="debug-result error">
                            Could not re-attach event listeners: ${e.message}
                        </div>
                    `;
                }
            }
            
            // Fix 4: Add a simple test listener to startKapitaal
            const startKapitaal = document.getElementById('startKapitaal');
            if (startKapitaal) {
                startKapitaal.addEventListener('input', (e) => {
                    console.log('Input value changed:', e.target.value);
                });
                results.innerHTML += `
                    <div class="debug-result success">
                        Added console logging to startKapitaal input
                    </div>
                `;
            }
            
            results.innerHTML += `
                <div class="debug-result" style="background: #d4edda; color: #155724;">
                    <strong>Fixes applied!</strong> Try entering values in the calculator now.
                </div>
            `;
        }

        // Auto-run checks on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Running automatic diagnostics...');
                checkInputs();
                checkCSS();
                checkJS();
            }, 1000);
        });
    </script>
</body>
</html>